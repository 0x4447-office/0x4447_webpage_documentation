(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{366:function(t,e,a){"use strict";a.r(e);var s=a(45),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),a("p",[t._v("Before you start you need to be aware this is not a product for everyone. This product is for DevOps that know AWS, and all its intricacy. You need to be experience with AWS, to use this product.")]),t._v(" "),a("h1",{attrs:{id:"understand-the-basics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#understand-the-basics"}},[t._v("#")]),t._v(" Understand the basics")]),t._v(" "),a("h3",{attrs:{id:"resilience"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resilience"}},[t._v("#")]),t._v(" Resilience")]),t._v(" "),a("p",[t._v("If you want to always be able to connect the same internal IP, make sure to start the EC2 Instance and keep the same local IP settings. This way, even if the instance gets terminated and you have to recreate it, the IP will stay the same and your user won't have to change any of their configurations.")]),t._v(" "),a("h3",{attrs:{id:"security"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security"}},[t._v("#")]),t._v(" Security")]),t._v(" "),a("p",[t._v("Our product is configured to only allow guest access, meaning there are no user accounts. This makes it very straight forward for users to mount the drive and share data across the company.")]),t._v(" "),a("p",[t._v("But this also means that "),a("strong",[t._v("you can't have the server deployed on a public network with a public IP")]),t._v(". You need to deploy the server in a private network and use a VPN server to access it. By default we do set a public IP using the CloudFormation file, for you to access the server to manage it if needed, but the default setting for the security group is not to have the SSH port open. This way there is no remote access to the public, but the server is always set to be accesed publicly if needed.")]),t._v(" "),a("p",[t._v("This way the Samba-server can be accessed only through a VPN connection. If you are looking for an affordable VPN server, we recommend the "),a("a",{attrs:{href:"https://aws.amazon.com/marketplace/pp/B0839R5C7Z",target:"_blank",rel:"noopener noreferrer"}},[t._v("openvpn-server"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h1",{attrs:{id:"cloudformation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cloudformation"}},[t._v("#")]),t._v(" CloudFormation")]),t._v(" "),a("a",{attrs:{target:"_blank",href:"https://console.aws.amazon.com/cloudformation/home#/stacks/new?stackName=zer0x4447-Samba&templateURL=https://s3.amazonaws.com/0x4447-drive-cloudformation/samba-server.json"}},[a("img",{staticStyle:{float:"left",margin:"0 10px 0 0"},attrs:{align:"left",src:"https://s3.amazonaws.com/cloudformation-examples/cloudformation-launch-stack.png"}})]),t._v(" "),a("p",[t._v("We provide a complementary CloudFormation file. Click the orange button to deploy the stack. If you want to check the CloudFormation yourself, follow "),a("a",{attrs:{href:"https://github.com/0x4447-Paid-Products/0x4447_product_paid_samba",target:"_blank",rel:"noopener noreferrer"}},[t._v("this link"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("Using our CF will allow you to deploy the stack with minimal work on your part. But, if you'd like to deploy the stack by hand, from this point on you'll find the manual on how to do so.")]),t._v(" "),a("hr"),t._v(" "),a("h1",{attrs:{id:"manual"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manual"}},[t._v("#")]),t._v(" Manual")]),t._v(" "),a("p",[t._v("Before launching an instance, you'll have to do some manual inputs to make everything work correctly. Please follow these steps in the order displayed here:")]),t._v(" "),a("p",[a("strong",[t._v("WARNING")]),t._v(": text written in capital letters needs to be replaced with real values.")]),t._v(" "),a("h3",{attrs:{id:"custom-role"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-role"}},[t._v("#")]),t._v(" Custom Role")]),t._v(" "),a("p",[t._v("Create a new role for the instance that will carry our product. The role must be for the "),a("code",[t._v("EC2")]),t._v(" resource; it needs to have attached the "),a("code",[t._v("AmazonEC2ReadOnlyAccess")]),t._v(" managed policy and have this inline policy:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2012-10-17"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Statement"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2:AttachVolume"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2:DetachVolume"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2:DescribeVolumes"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"security-group"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security-group"}},[t._v("#")]),t._v(" Security Group")]),t._v(" "),a("p",[t._v("A default security group will be automatically created for you from the product configuration, but if you'd like to make one by hand, you need to have this port open towards the instance:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("445")]),t._v(" over "),a("code",[t._v("TCP")]),t._v(" for connectivity to Samba")])]),t._v(" "),a("p",[t._v("Opening port "),a("code",[t._v("22")]),t._v(" is unnecessary since this product is unmanaged, meaning there is no manual input needed in the OS itself.")]),t._v(" "),a("h3",{attrs:{id:"bash-script-for-userdata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bash-script-for-userdata"}},[t._v("#")]),t._v(" Bash Script for UserData")]),t._v(" "),a("p",[t._v("Once you have everything setup, you can replace the place holder values with the real ID's. Make sure to replace the values that are in all CAPS that end with "),a("code",[t._v("_ID")]),t._v(" with the real data.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/usr/bin/env bash")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /home/ec2-user/.env")]),t._v("\nDRIVES=EBS_ID,EBS_ID,EBS_ID,EBS_ID,ETC...\nHOSTNAME=THE_NAME_OF_THE_HOST\nEOF")]),t._v("\n")])])]),a("p",[t._v("Explanation:")]),t._v(" "),a("ol",[a("li",[t._v("Set the variable with a list (separated by commas) of EBS drives to be mounted - max 25.")]),t._v(" "),a("li",[t._v("Set the hostname of the instance, so you you can name your server.")])]),t._v(" "),a("p",[a("strong",[t._v("Understand how UserData works")])]),t._v(" "),a("p",[t._v("It is important to note that the content of the UserData field will be only executed once, which occurs when the instance starts for the first time. This means that the content of the UserData won't be trigered if you stop and start the instance. If you choose to not enable resilience and want to skip the UserData script at boot time, then you won't be able to later update the UserData with the script and can't expect for the automation to take place. You have two options:")]),t._v(" "),a("ul",[a("li",[t._v("Either you follow "),a("a",{attrs:{href:"https://aws.amazon.com/premiumsupport/knowledge-center/execute-user-data-ec2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("this link"),a("OutboundLink")],1),t._v(" for a work around.")]),t._v(" "),a("li",[t._v("Or your start a new instance, this time with the right UserData, and then copy over all the configuration files from the old instance to the new one.")])]),t._v(" "),a("h3",{attrs:{id:"connect-to-the-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#connect-to-the-server"}},[t._v("#")]),t._v(" Connect to the Server")]),t._v(" "),a("p",[t._v("Once the instance is up and running, get its IP and connect to the instance over SSH using the slected key at deployment time.")]),t._v(" "),a("h1",{attrs:{id:"test-the-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-the-setup"}},[t._v("#")]),t._v(" Test The Setup")]),t._v(" "),a("p",[t._v("Be sure to test the server to make sure it behaves the way we have described it; not because we don't belive it works correctly, but to make sure you are confortable with the product and know how it works, especially the resiliance mode.")]),t._v(" "),a("h2",{attrs:{id:"test-1-viewing-shares-from-your-ubuntu-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-1-viewing-shares-from-your-ubuntu-client"}},[t._v("#")]),t._v(" Test 1 - Viewing shares from your Ubuntu Client")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# sudo apt install smbclient\n# smbclient -L \\\\<samba-local-ip>\\\nEnter WORKGROUP\\ubuntu's password:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        vol-02df7017709d5ec45 Disk\n        IPC$            IPC       IPC Service (samba_server)\n")])])]),a("h2",{attrs:{id:"test-2-mounting-the-samba-drive-from-your-ubuntu-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-2-mounting-the-samba-drive-from-your-ubuntu-client"}},[t._v("#")]),t._v(" Test 2 - Mounting the Samba Drive from your Ubuntu Client")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# sudo apt install cifs-utils\n# sudo mount -t cifs //172.31.0.21/vol-02df7017709d5ec45 /mnt/samba\n# cd /mnt/samba\n")])])]),a("h2",{attrs:{id:"test-3-termination-and-ip-retention"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-3-termination-and-ip-retention"}},[t._v("#")]),t._v(" Test 3 - Termination and IP retention")]),t._v(" "),a("p",[t._v("Terminate the instance and start a new one with the correct UserData, and see if after the instance booted everything works as expected.")]),t._v(" "),a("h1",{attrs:{id:"backup-your-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backup-your-data"}},[t._v("#")]),t._v(" Backup Your Data")]),t._v(" "),a("p",[t._v("Make sure you regularly backup your EFS and EBS drive. One simple solution would be to use "),a("a",{attrs:{href:"https://aws.amazon.com/backup/",target:"_blank",rel:"noopener noreferrer"}},[t._v("AWS backup"),a("OutboundLink")],1),t._v(" for EFS and snapshotting for EBS.")]),t._v(" "),a("h1",{attrs:{id:"security-concerns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security-concerns"}},[t._v("#")]),t._v(" Security Concerns")]),t._v(" "),a("p",[t._v("Bellow we give you a list of potential ideas worth considiering regarding security, but this list is not exhaustive; it is just a good starting point.")]),t._v(" "),a("ul",[a("li",[t._v("Never expose this server to the public. Use it only inside a private network to limit who can send logs.")]),t._v(" "),a("li",[t._v("Allow mounting only from specific subnets.")]),t._v(" "),a("li",[t._v("Block public SSH access.")]),t._v(" "),a("li",[t._v("Allow SSH connection only from limited subnets.")]),t._v(" "),a("li",[t._v("Ideally allow SSH connection only from another central instance.")]),t._v(" "),a("li",[t._v("Don't give root access to anyone but yourself.")])])])}),[],!1,null,null,null);e.default=r.exports}}]);