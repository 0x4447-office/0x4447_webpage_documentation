(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{368:function(t,e,s){"use strict";s.r(e);var a=s(45),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"prerequisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),s("p",[t._v("Before you start you need to be aware this is not a product for everyone. This product is for DevOps that know AWS, and all its intricacy. You need to be experience with AWS, to use this product.")]),t._v(" "),s("h1",{attrs:{id:"understand-the-basics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#understand-the-basics"}},[t._v("#")]),t._v(" Understand the basics")]),t._v(" "),s("h3",{attrs:{id:"resilience"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resilience"}},[t._v("#")]),t._v(" Resilience")]),t._v(" "),s("p",[t._v("Our VPN Server has built in resilience to make sure that you don't lose all your users, lose the VPN configuration, or lose connectivity by a changing IP. For this to work, you'll need to allocate an Elastic IP and create an EFS Drive. Also, take note of the IDs that you'll get so that you can use them in the EC2 UserData section.")]),t._v(" "),s("h3",{attrs:{id:"security"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#security"}},[t._v("#")]),t._v(" Security")]),t._v(" "),s("p",[t._v("This product was designed for public access, but we recommend you don't allow SSH connections from the public Internet. Expose only the VPN ports and allow SSH access from a special instance within your private network.")]),t._v(" "),s("h1",{attrs:{id:"cloudformation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cloudformation"}},[t._v("#")]),t._v(" CloudFormation")]),t._v(" "),s("h3",{attrs:{id:"pre-requisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pre-requisites"}},[t._v("#")]),t._v(" Pre-Requisites")]),t._v(" "),s("p",[t._v("Before you hit the orange icon below to launch our complementary CloudFormation file, you will need the following pre-requisite resources in AWS:")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("EC2 Key Pair")]),t._v(": An EC2 key pair to access your EC2 instance via SSH. This needs to be specified in the CloudFormation parameter "),s("em",[t._v("KeyNameParam")])])]),t._v(" "),s("h3",{attrs:{id:"launch-the-stack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#launch-the-stack"}},[t._v("#")]),t._v(" Launch the Stack")]),t._v(" "),s("a",{attrs:{target:"_blank",href:"https://console.aws.amazon.com/cloudformation/home#/stacks/new?stackName=zer0x4447-openvpn&templateURL=https://s3.amazonaws.com/0x4447-drive-cloudformation/openvpn-server.json"}},[s("img",{staticStyle:{float:"left",margin:"0 10px 0 0"},attrs:{align:"left",src:"https://s3.amazonaws.com/cloudformation-examples/cloudformation-launch-stack.png"}})]),t._v(" "),s("p",[t._v("We provide a complementary CloudFormation file. Click the orange button to deploy the stack. If you want to check the CloudFormation yourself, follow "),s("a",{attrs:{href:"https://s3.amazonaws.com/0x4447-drive-cloudformation/openvpn-server.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("this link"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("Using our CF will allow you to deploy the stack with minimal work on your part. But if you'd like to do the deployment by hand, from this point on, you'll find the manual on how to do so.")]),t._v(" "),s("hr"),t._v(" "),s("h1",{attrs:{id:"manual"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#manual"}},[t._v("#")]),t._v(" Manual")]),t._v(" "),s("p",[t._v("Before launching an instance, you'll have to do some manual work to make everything work correctly. Please follow these steps in order displayed here:")]),t._v(" "),s("p",[s("strong",[t._v("WARNING")]),t._v(": text written in capital letters needs to be replaced with real values.")]),t._v(" "),s("h3",{attrs:{id:"custom-role"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#custom-role"}},[t._v("#")]),t._v(" Custom Role")]),t._v(" "),s("p",[t._v("Before you can set the UserData, you have to attach a Role to the Instance with a Policy that has this Document:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2012-10-17"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Statement"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Effect"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Allow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Action"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ec2:AssociateAddress"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Resource"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("This Policy Document will give the Instance the ability to attach the Elastic IP to itself. The "),s("code",[t._v('"Resource": "*"')]),t._v(" is stated this way intentionally, and the "),s("code",[t._v("AssociateAddress")]),t._v(" actions is not resource specific.")]),t._v(" "),s("h3",{attrs:{id:"security-group"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#security-group"}},[t._v("#")]),t._v(" Security Group")]),t._v(" "),s("p",[t._v("A default security group will be created for you automatically from the product configuration, but if you'd like to make one by hand, you need to have one of these ports open towards the instance:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("22")]),t._v(" over "),s("code",[t._v("TCP")]),t._v(" for remote managment.")]),t._v(" "),s("li",[s("code",[t._v("443")]),t._v(" over "),s("code",[t._v("TCP")]),t._v(" for VPN connections.")]),t._v(" "),s("li",[s("code",[t._v("2049")]),t._v(" over "),s("code",[t._v("TCP")]),t._v(" for EFS to be mounted.")])]),t._v(" "),s("h3",{attrs:{id:"bash-script-for-userdata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bash-script-for-userdata"}},[t._v("#")]),t._v(" Bash Script for UserData")]),t._v(" "),s("p",[t._v("Once you have everything setup, you can replace the place-holder values with the real IDs. Make sure to replace the values that are in all CAPS with the real data.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EFS_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fs-REPLACE_WITH_REAL_VALUE\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EIP_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("eipalloc-REPLACE_WITH_REAL_VALUE\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SERVER_DNS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("DNS_NAME\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VPN_SPLIT_TUNNEL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("DNS_NAME\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VPN_SPLIT_TUNNEL_NETWORK")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("IP_OF_THE_NETWORK_FOR_EXAMPLE_10.0.0.0\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VPN_SPLIT_TUNNEL_SUBNET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("IP_OF_THE_NETWORK_MASK_FOR_EXAMPLE_255.255.255.0\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EFS_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$EFS_ID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /home/ec2-user/.env\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EIP_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$EIP_ID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /home/ec2-user/.env\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SERVER_DNS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SERVER_DNS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /home/ec2-user/.env\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VPN_SPLIT_TUNNEL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$VPN_SPLIT_TUNNEL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /home/ec2-user/.env\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VPN_SPLIT_TUNNEL_NETWORK")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$VPN_SPLIT_TUNNEL_NETWORK")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /home/ec2-user/.env\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VPN_SPLIT_TUNNEL_SUBNET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$VPN_SPLIT_TUNNEL_SUBNET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /home/ec2-user/.env\n")])])]),s("p",[t._v("Explanation:")]),t._v(" "),s("ol",[s("li",[t._v("Set the ID of the EFS drive.")]),t._v(" "),s("li",[t._v("Set the ID of the Elastic IP.")]),t._v(" "),s("li",[t._v("Set the DNS name that you will use to map the public instance IP. This will be used in the VPN profile file.")]),t._v(" "),s("li",[t._v("Set if you want partial or all traffic going thorugh the VPN.")]),t._v(" "),s("li",[t._v("Set the Private VPN server IP.")]),t._v(" "),s("li",[t._v("Set the network mask for the IP.")]),t._v(" "),s("li",[t._v("Append all the values to the .env file.")])]),t._v(" "),s("p",[s("strong",[t._v("Understand how UserData works")])]),t._v(" "),s("p",[t._v("It is important to note that the content of the UserData field will be only executed once, when the instance starts for the first time. This means it won't be triggered if you stop and start the instance. If you chose to not enable resilience and skip the UserData script at boot time, then later on you won't be able to update the UserData with the script or expect for the automation to take place. You have two options:")]),t._v(" "),s("ul",[s("li",[t._v("Either you follow "),s("a",{attrs:{href:"https://aws.amazon.com/premiumsupport/knowledge-center/execute-user-data-ec2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("this link"),s("OutboundLink")],1),t._v(" for a work around.")]),t._v(" "),s("li",[t._v("Or your start a new instance, this time with the right UserData, and then copy over from the old instance to the new one all the configuration files.")])]),t._v(" "),s("h3",{attrs:{id:"the-first-boot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#the-first-boot"}},[t._v("#")]),t._v(" The First Boot")]),t._v(" "),s("p",[t._v("Grab a cup of coffee since the first boot will be slower then what you are used to. This is due to the certificate that we need to generate for VPN. Since at boot time there isn't much going on in the system, this process can take around 12 min, depending on the instance type. But not to worry; this only happens when the certificate is not found in the system.")]),t._v(" "),s("h3",{attrs:{id:"connect-to-the-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#connect-to-the-server"}},[t._v("#")]),t._v(" Connect to the server")]),t._v(" "),s("p",[t._v("Once the instance is up and running, get its IP and connect to the instance over SSH using the selected key at deployment time.\n"),s("strong",[t._v("Note")]),t._v(": SSH access is restricted to the public and to the root user. You will need to allow your specific system access by adding an inbound rule to the Security group used by the VPN EC2 instance. You can then access the VPN server using the EC2 key pair and login as "),s("em",[t._v("ec2-user")]),t._v(".")]),t._v(" "),s("h1",{attrs:{id:"user-management"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#user-management"}},[t._v("#")]),t._v(" User Management")]),t._v(" "),s("h3",{attrs:{id:"how-to-create-a-user"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-create-a-user"}},[t._v("#")]),t._v(" How to create a user")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Run this command and answer all the questions:")]),t._v(" "),s("p",[s("code",[t._v('sudo bash /opt/0x4447/openvpn/ov_user_add.sh "USER_NAME"')])])]),t._v(" "),s("li",[s("p",[t._v("Every time you do so, a new "),s("code",[t._v(".ovpn")]),t._v(" file will be created in the "),s("code",[t._v("openvpn_users")]),t._v(" folder located in the "),s("code",[t._v("ec2-user")]),t._v(" folder. You can copy the new file to your local computer using the "),s("code",[t._v("SCP")]),t._v(" command, like so:")]),t._v(" "),s("p",[s("code",[t._v("scp -i /cert/path/ SERVER_IP:/home/ec2-user/openvpn_users/USER_NAME.ovpn .")])])]),t._v(" "),s("li",[s("p",[t._v("Share the file with the selected user.")])])]),t._v(" "),s("h3",{attrs:{id:"how-to-delete-a-user"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-delete-a-user"}},[t._v("#")]),t._v(" How to delete a user")]),t._v(" "),s("p",[t._v("Just run the following command and set the right user name:")]),t._v(" "),s("p",[s("code",[t._v('sudo bash /opt/0x4447/openvpn/ov_user_delete.sh "USER_NAME"')])]),t._v(" "),s("h3",{attrs:{id:"how-to-list-all-the-users"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-to-list-all-the-users"}},[t._v("#")]),t._v(" How to list all the users")]),t._v(" "),s("p",[t._v("Since every time you create a user a "),s("code",[t._v(".ovpn")]),t._v(" configuration file is created, you can just list the content of the "),s("code",[t._v("openvpn_users")]),t._v(" folder, like so:")]),t._v(" "),s("p",[s("code",[t._v("ls -la /home/ec2-user/openvpn_users")])]),t._v(" "),s("p",[t._v("The output is the list of all the users you have available for your VPN server.")]),t._v(" "),s("h1",{attrs:{id:"vpn-clients"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vpn-clients"}},[t._v("#")]),t._v(" VPN Clients")]),t._v(" "),s("ul",[s("li",[t._v("Desktop\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://openvpn.net/client-connect-vpn-for-windows/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Windows"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://openvpn.net/client-connect-vpn-for-mac-os/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MacOS"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://openvpn.net/vpn-server-resources/how-to-connect-to-access-server-from-a-linux-computer/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux"),s("OutboundLink")],1)])])]),t._v(" "),s("li",[t._v("Mobile\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://apps.apple.com/us/app/openvpn-connect/id590379981",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://play.google.com/store/apps/details?id=net.openvpn.openvpn&hl=en",target:"_blank",rel:"noopener noreferrer"}},[t._v("Android"),s("OutboundLink")],1)])])])]),t._v(" "),s("h1",{attrs:{id:"test-the-setup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#test-the-setup"}},[t._v("#")]),t._v(" Test The Setup")]),t._v(" "),s("p",[t._v("Be sure to test the server to confirm that it behaves the way we advertise it; not becasue we don't belive it works correctly, but to make sure you are comfortable with the product and know how it works, especially the resiliance mode.")]),t._v(" "),s("h3",{attrs:{id:"step-1-generate-ubuntu-and-windows-clients"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-1-generate-ubuntu-and-windows-clients"}},[t._v("#")]),t._v(" Step 1 - Generate Ubuntu and Windows Clients")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Login to your VPN Server")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" -i ec2_key_pair ec2-user@"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("your-elastic-ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### On your VPN Server")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" /opt/0x4447/openvpn/ov_user_add.sh "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"win-client"')]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" /opt/0x4447/openvpn/ov_user_add.sh "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ubuntu-client"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Download the keys to the system that has access to your VPN server")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" -i openssh_key ec2-user@"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("your-elastic-ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":openvpn_users/win-client.ovpn "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" -i openssh_key ec2-user@"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("your-elastic-ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":openvpn_users/ubuntu-client.ovpn "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),s("h3",{attrs:{id:"step-2-test-connectivity-from-a-ubuntu-instance"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-2-test-connectivity-from-a-ubuntu-instance"}},[t._v("#")]),t._v(" Step 2 - Test connectivity from a Ubuntu instance")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Install and run the VPN client on a Ubuntu instance")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" openvpn\n$ openvpn --config ubuntu-client.ovpn\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Check if a TUN interface has been created")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ifconfig")]),t._v("\ntun0: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("flags")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("430")]),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("5")]),t._v("<")]),t._v("UP,POINTOPOINT,RUNNING,NOARP,MULTICAST"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  mtu "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1500")]),t._v("\n        inet "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.3  netmask "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255.255")]),t._v(".0.0  destination "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.3\n        inet6 fe80::38d4:cb89:46f6:a288  prefixlen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("  scopeid 0x2"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v("<")]),t._v("link"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UNSPEC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        RX packets "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  bytes "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        RX errors "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  dropped "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  overruns "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  frame "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n        TX packets "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("  bytes "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("48")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("48.0")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        TX errors "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  dropped "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" overruns "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  carrier "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  collisions "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Ping the VPN gateway")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("84")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes of data.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("118")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.02")]),t._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("118")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.978")]),t._v(" ms\n--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" statistics ---\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" packets transmitted, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" received, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("% packet loss, "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" 1001ms\n")])])]),s("h3",{attrs:{id:"step-3-test-connectivity-from-a-windows-client"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-3-test-connectivity-from-a-windows-client"}},[t._v("#")]),t._v(" Step 3 - Test connectivity from a windows client")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Download the VPN client for windows and load the win-client.ovpn that was created in Step 1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Run ipconfig on windows cmd prompt or ifconfig on WSL")]),t._v("\nipconfig/ifconfig:\neth6: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("flags")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("416")]),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("3")]),t._v("<")]),t._v("UP,BROADCAST,RUNNING,MULTICAST"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  mtu "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1500")]),t._v("\n        inet "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.2  netmask "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255.255")]),t._v(".0.0  broadcast "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".255.255\n        inet6 fe80::24c4:b8be:de58:cf4c  prefixlen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("  scopeid 0xfd"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("compat,link,site,host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        ether 00:ff:7c:48:11:38  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ethernet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        RX packets "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  bytes "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        RX errors "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  dropped "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  overruns "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  frame "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n        TX packets "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  bytes "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        TX errors "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  dropped "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" overruns "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  carrier "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  collisions "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Ping the VPN gateway")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("84")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes of data.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("118")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.02")]),t._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("118")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.978")]),t._v(" ms\n--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" statistics ---\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" packets transmitted, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" received, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("% packet loss, "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" 1001ms\n")])])]),s("h3",{attrs:{id:"step-4-test-instance-scale-up-or-scale-down"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-4-test-instance-scale-up-or-scale-down"}},[t._v("#")]),t._v(" Step 4 - Test instance scale-up or scale-down")]),t._v(" "),s("p",[t._v("Stop the EC2 instance and change the instance type to a larger or smaller one based on your need. Both the Ubuntu and the windows clients should connect automatically once the VPN Server is up.")]),t._v(" "),s("h3",{attrs:{id:"step-5-site-to-site-connectivity"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-5-site-to-site-connectivity"}},[t._v("#")]),t._v(" Step 5 - Site to Site connectivity")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Login to your VPN Server")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" -i ec2_key_pair ec2-user@"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("your-elastic-ip"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### On your VPN Server")]),t._v("\n$ sysctl net.ipv4.ip_forward"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Ping the windows client from the ubuntu client. On you Ubuntu client:")]),t._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.2\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("84")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes of data.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.2: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("118")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.02")]),t._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.2: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("118")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.978")]),t._v(" ms\n--- "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.8")]),t._v(".0.2 "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" statistics ---\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" packets transmitted, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" received, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("% packet loss, "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" 1001ms\n")])])]),s("h1",{attrs:{id:"backup-your-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#backup-your-data"}},[t._v("#")]),t._v(" Backup your Data")]),t._v(" "),s("p",[t._v("Make sure you regularly backup your EFS drive. One simple solution would be to use "),s("a",{attrs:{href:"https://aws.amazon.com/backup/",target:"_blank",rel:"noopener noreferrer"}},[t._v("AWS backup"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("h1",{attrs:{id:"security-concerns"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#security-concerns"}},[t._v("#")]),t._v(" Security Concerns")]),t._v(" "),s("p",[t._v("Below we give you a list of potentail ideas that are worth considiering regarding security, but this list dose not exhaust all possibilities; it is just a good starting point.")]),t._v(" "),s("ul",[s("li",[t._v("Expose to the public only the ports needed for clients to connect to the VPN.")]),t._v(" "),s("li",[t._v("Block public SSH access.")]),t._v(" "),s("li",[t._v("Allow SSH connection only from limited subnets.")]),t._v(" "),s("li",[t._v("Ideally allow SSH connection only from another central instance.")]),t._v(" "),s("li",[t._v("Don't give root access to anyone but yourself.")])]),t._v(" "),s("h1",{attrs:{id:"troubleshooting-tips"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting-tips"}},[t._v("#")]),t._v(" Troubleshooting tips")]),t._v(" "),s("p",[t._v("These are some of the common solutions to problems you may run into:")]),t._v(" "),s("h2",{attrs:{id:"my-cloudformation-stack-failed-with-the-following-error"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#my-cloudformation-stack-failed-with-the-following-error"}},[t._v("#")]),t._v(" My CloudFormation stack failed with the following error")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("API: ec2:RunInstances Not authorized for images:\n")])])]),s("p",[s("strong",[t._v("SOLUTION")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("Accept the subscription for this image on AWS marketplace and then re-launch your stack.")])]),t._v(" "),s("h2",{attrs:{id:"failed-to-access-the-vpn-server-using-ssh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#failed-to-access-the-vpn-server-using-ssh"}},[t._v("#")]),t._v(" Failed to access the VPN server using SSH")]),t._v(" "),s("p",[s("strong",[t._v("SOLUTION")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("Ensure that your public IP address is allowed to access the VPN EC2 instance. You will need to add an inbound rule to the Security Group used by the VPN EC2 instance.")]),t._v(" "),s("li",[t._v("Ensure you are using the right EC2 Key Pair that you provided when you launched your stack using Cloud Formation.")]),t._v(" "),s("li",[t._v("Ensure you are not using the "),s("em",[t._v("root")]),t._v(" user to login as this is disabled. You need to login as "),s("em",[t._v("ec2-user")])])]),t._v(" "),s("h2",{attrs:{id:"user-management-failed-with-an-error"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#user-management-failed-with-an-error"}},[t._v("#")]),t._v(" User Management failed with an error")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('sh-4.2$ sudo bash /opt/0x4447/openvpn/ov_user_add.sh "test-client"\n/opt/0x4447/openvpn/ov_user_add.sh: line 23: vars: No such file or directory\n')])])]),s("p",[s("strong",[t._v("SOLUTION")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("The above error indicates that this instance failed to mount your EFS drive. You will also see the following message in your dmesg")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('amazon/efs/mount.log:2020-09-04 23:29:58,803 - ERROR - Failed to mount fs-90d252e8.efs.us-east-2.amazonaws.com at /etc/openvpn/easy-rsa: retu Connection timed out"\n')])])]),s("ul",[s("li",[t._v("Ensure that your EFS Drive allows inbound connections on TCP Port 2049 from your Elastic IP and the EC2 subnet being used by the VPN Server")])]),t._v(" "),s("h2",{attrs:{id:"ping-to-another-client-instance-over-vpn-fails"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ping-to-another-client-instance-over-vpn-fails"}},[t._v("#")]),t._v(" Ping to another client instance over VPN fails")]),t._v(" "),s("p",[s("strong",[t._v("SOLUTION")]),t._v(":")]),t._v(" "),s("ul",[s("li",[t._v("If you can ping the default gateway 10.8.0.1 but cannot reach another client behind VPN, check if you have enabled ip_forward on the VPN Server.")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### On your VPN Server")]),t._v("\n$ sysctl net.ipv4.ip_forward"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])])])}),[],!1,null,null,null);e.default=n.exports}}]);